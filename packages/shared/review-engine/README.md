# Review Engine

å£ã‚³ãƒŸè‡ªå‹•æŠ•ç¨¿ã‚¨ãƒ³ã‚¸ãƒ³

## æ¦‚è¦

534ä»¶ã®å£ã‚³ãƒŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã‚µã‚¤ãƒˆå“è³ªã«å¿œã˜ãŸè‡ªå‹•å£ã‚³ãƒŸæŠ•ç¨¿ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | ä»¶æ•° | ç”¨é€” | å¯¾è±¡ã‚µã‚¤ãƒˆå“è³ª |
|---------|------|------|--------------|
| â­1ï¼ˆè¾›å£ï¼ã‚¯ãƒ¬ãƒ¼ãƒ å¯„ã‚Šï¼‰.txt | 70ä»¶ | è¾›å£ãƒ»ã‚¯ãƒ¬ãƒ¼ãƒ  | malicious |
| â­2ï¼ˆå°‘ã—è¾›å£å¯„ã‚Šï¼‰.txt | 130ä»¶ | ã‚„ã‚„è¾›å£ | poor, malicious |
| â­3ï¼ˆãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ï¼‰.txt | 70ä»¶ | ä¸­ç«‹çš„è©•ä¾¡ | normal, poor |
| â­3ï¼ˆã‚„ã‚„ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼‰.txt | 90ä»¶ | æœŸå¾…å€¤ã‚„ã‚„ä¸‹å›ã‚‹ | premium, excellent |
| â­4ï¼ˆå°‘ã—ãƒã‚¸ãƒ†ã‚£ãƒ–å¯„ã‚Šï¼‰.txt | 74ä»¶ | ãƒã‚¸ãƒ†ã‚£ãƒ– | normal, excellent |
| â­5ï¼ˆpremiumå°‚ç”¨ãƒ»é«˜è©•ä¾¡ï¼‰.txt | 100ä»¶ | æœ€é«˜è©•ä¾¡ | premium, excellent |
| **åˆè¨ˆ** | **534ä»¶** | - | - |

## ã‚µã‚¤ãƒˆå“è³ªåˆ¥ã®è©•ä¾¡åˆ†å¸ƒ

### ğŸŒŸ premiumï¼ˆå—é–¢ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹å°‚ç”¨ï¼‰
- è©•ä¾¡ç¯„å›²: â­3-5
- æŠ•ç¨¿é »åº¦: æ¯æ—¥100%
- é‡ã¿ä»˜ã‘: â­3(20%), â­4(60%), â­5(20%)
- å¹³å‡è©•ä¾¡: 4.0
- å£ã‚³ãƒŸä¸Šé™: 100ä»¶

### âœ… excellentï¼ˆå„ªè‰¯ã‚µã‚¤ãƒˆï¼‰
- è©•ä¾¡ç¯„å›²: â­3-5
- æŠ•ç¨¿é »åº¦: æ¯æ—¥100%
- é‡ã¿ä»˜ã‘: â­3(15%), â­4(60%), â­5(25%)
- å¹³å‡è©•ä¾¡: 4.1
- å£ã‚³ãƒŸä¸Šé™: 80ä»¶
- å‚™è€ƒ: â­3ã¯ã€Œã‚„ã‚„ãƒã‚¸ãƒ†ã‚£ãƒ–ã€ç‰ˆã‚’ä½¿ç”¨

### âšª normalï¼ˆé€šå¸¸ã‚µã‚¤ãƒˆï¼‰
- è©•ä¾¡ç¯„å›²: â­2-4
- æŠ•ç¨¿é »åº¦: 2-3æ—¥ã«1å›ï¼ˆ40%ï¼‰
- å¹³å‡è©•ä¾¡: ç´„3.0
- å£ã‚³ãƒŸä¸Šé™: 30ä»¶

### âš ï¸ poorï¼ˆä½å“è³ªã‚µã‚¤ãƒˆï¼‰
- è©•ä¾¡ç¯„å›²: â­1-3
- æŠ•ç¨¿é »åº¦: 3-4æ—¥ã«1å›ï¼ˆ30%ï¼‰
- å¹³å‡è©•ä¾¡: ç´„2.0
- å£ã‚³ãƒŸä¸Šé™: 40ä»¶

### âŒ maliciousï¼ˆæ‚ªè³ªã‚µã‚¤ãƒˆï¼‰
- è©•ä¾¡ç¯„å›²: â­1-2
- æŠ•ç¨¿é »åº¦: 5æ—¥ã«1å›ï¼ˆ20%ï¼‰
- å¹³å‡è©•ä¾¡: ç´„1.5
- å£ã‚³ãƒŸä¸Šé™: 50ä»¶

## ä½¿ã„æ–¹

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿

```typescript
import { readFileSync } from 'fs';
import { join } from 'path';

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿é–¢æ•°
function loadTemplate(rating: number, type: 'neutral' | 'positive' = 'neutral'): string[] {
  const templateDir = join(__dirname, 'templates');
  let filename: string;

  switch(rating) {
    case 1:
      filename = 'â­1ï¼ˆè¾›å£ï¼ã‚¯ãƒ¬ãƒ¼ãƒ å¯„ã‚Šï¼‰.txt';
      break;
    case 2:
      filename = 'â­2ï¼ˆå°‘ã—è¾›å£å¯„ã‚Šï¼‰.txt';
      break;
    case 3:
      filename = type === 'positive'
        ? 'â­3ï¼ˆã‚„ã‚„ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼‰.txt'
        : 'â­3ï¼ˆãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ï¼‰.txt';
      break;
    case 4:
      filename = 'â­4ï¼ˆå°‘ã—ãƒã‚¸ãƒ†ã‚£ãƒ–å¯„ã‚Šï¼‰.txt';
      break;
    case 5:
      filename = 'â­5ï¼ˆpremiumå°‚ç”¨ãƒ»é«˜è©•ä¾¡ï¼‰.txt';
      break;
    default:
      throw new Error(`Invalid rating: ${rating}`);
  }

  const content = readFileSync(join(templateDir, filename), 'utf-8');
  return content.split('\n---\n').filter(t => t.trim());
}

// ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
function getRandomTemplate(rating: number, type?: 'neutral' | 'positive'): string {
  const templates = loadTemplate(rating, type);
  return templates[Math.floor(Math.random() * templates.length)];
}
```

### ã‚µã‚¤ãƒˆå“è³ªåˆ¥ã®è©•ä¾¡é¸æŠ

```typescript
import { SiteQuality } from '@keiba-review/shared/types';

function selectRating(siteQuality: SiteQuality): { rating: number; type?: 'neutral' | 'positive' } {
  const rand = Math.random();

  switch(siteQuality) {
    case 'premium':
      // â­3:20%, â­4:60%, â­5:20%
      if (rand < 0.20) return { rating: 3, type: 'positive' };
      if (rand < 0.80) return { rating: 4 };
      return { rating: 5 };

    case 'excellent':
      // â­3:15%, â­4:60%, â­5:25%
      if (rand < 0.15) return { rating: 3, type: 'positive' };
      if (rand < 0.75) return { rating: 4 };
      return { rating: 5 };

    case 'normal':
      // â­2:30%, â­3:40%, â­4:30%
      if (rand < 0.30) return { rating: 2 };
      if (rand < 0.70) return { rating: 3, type: 'neutral' };
      return { rating: 4 };

    case 'poor':
      // â­1:30%, â­2:40%, â­3:30%
      if (rand < 0.30) return { rating: 1 };
      if (rand < 0.70) return { rating: 2 };
      return { rating: 3, type: 'neutral' };

    case 'malicious':
      // â­1:60%, â­2:40%
      if (rand < 0.60) return { rating: 1 };
      return { rating: 2 };

    default:
      throw new Error(`Unknown site quality: ${siteQuality}`);
  }
}
```

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå½¢å¼

å„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼š

```
ã‚¿ã‚¤ãƒˆãƒ«1
æœ¬æ–‡1
---
ã‚¿ã‚¤ãƒˆãƒ«2
æœ¬æ–‡2
---
...
```

- å„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ `---` ã§åŒºåˆ‡ã‚‰ã‚Œã¦ã„ã¾ã™
- 1è¡Œç›®ãŒã‚¿ã‚¤ãƒˆãƒ«ã€2è¡Œç›®ä»¥é™ãŒæœ¬æ–‡ã§ã™
- æœ¬æ–‡ã¯20ã€œ500æ–‡å­—ã®ç¯„å›²ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™

## æ³¨æ„äº‹é …

### NGãƒ¯ãƒ¼ãƒ‰

ä»¥ä¸‹ã®ãƒ¯ãƒ¼ãƒ‰ã¯è‡ªå‹•æŠ•ç¨¿æ™‚ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ï¼š

- ã‚µãƒãƒ¼ãƒˆã€å¯¾å¿œãŒé…ã„ã€è¿”ä¿¡ãŒãªã„
- è©æ¬ºã€é¨™ã•ã‚ŒãŸã€æ‚ªè³ª
- æœ€æ‚ªã€ã²ã©ã„ã€é‡‘è¿”ã›

### ã‚«ãƒ†ã‚´ãƒªåˆ¥ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰

å„ã‚«ãƒ†ã‚´ãƒªã«ä¸é©åˆ‡ãªãƒ¯ãƒ¼ãƒ‰ã‚‚ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ï¼š

- **ä¸­å¤®ç«¶é¦¬**: å—é–¢ã€åœ°æ–¹ç«¶é¦¬é–¢é€£ã®ãƒ¯ãƒ¼ãƒ‰
- **å—é–¢ç«¶é¦¬**: G1ã€æœ‰é¦¬è¨˜å¿µãªã©ã®ä¸­å¤®ç«¶é¦¬é‡è³
- **åœ°æ–¹ç«¶é¦¬**: JRAã€G1ã€å—é–¢é–¢é€£ã®ãƒ¯ãƒ¼ãƒ‰

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

All templates are proprietary content for keiba-review projects.
