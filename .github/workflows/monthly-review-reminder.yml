name: Monthly Review Reminder

on:
  schedule:
    # 毎月1日 10:00 JST（01:00 UTC）
    - cron: '0 1 1 * *'
  workflow_dispatch: # 手動実行も可能

jobs:
  create-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Get current date and month
        id: date
        run: |
          echo "today=$(TZ=Asia/Tokyo date +'%Y-%m-%d')" >> $GITHUB_OUTPUT
          echo "month=$(TZ=Asia/Tokyo date +'%Y-%m')" >> $GITHUB_OUTPUT
          echo "last_month=$(TZ=Asia/Tokyo date -d '1 month ago' +'%Y-%m')" >> $GITHUB_OUTPUT

      - name: Create GitHub Issue
        uses: actions/github-script@v7
        with:
          script: |
            const today = '${{ steps.date.outputs.today }}';
            const month = '${{ steps.date.outputs.month }}';
            const lastMonth = '${{ steps.date.outputs.last_month }}';

            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `📊 月次レビュー（${month}）`,
              body: `
## 📊 月次レビューの時間です

Claude Codeで以下を実行してください：

**月次レビュー**


## 📋 必要なデータ（GA4で確認）

### 前月（${lastMonth}）の月間データ

#### nankan-review
- **月間訪問者数**（Users）: ___人
- **月間ページビュー数**: ___
- **nankan-analyticsクリック数**（月間合計）: ___回
- **オーガニック流入率**: ___%
- 平均セッション時間: ___秒
- 直帰率: ___%

#### keiba-review-all
- **月間訪問者数**（Users）: ___人
- **月間ページビュー数**: ___
- **nankan-analyticsクリック数**（月間合計）: ___回
- **オーガニック流入率**: ___%
- 平均セッション時間: ___秒
- 直帰率: ___%


## 📝 GA4でのデータ確認方法

### 月間データの取得

1. **GA4を開く**: https://analytics.google.com/
2. **期間を設定**: 画面右上の日付範囲を「前月（${lastMonth}）」に設定
   - 例: 2026-01-01 〜 2026-01-31

### 各指標の確認場所

#### 訪問者数・ページビュー数
**GA4 > レポート > ライフサイクル > エンゲージメント > 概要**
- ユーザー（訪問者数）
- 表示回数（ページビュー数）
- 平均エンゲージメント時間（セッション時間）
- 直帰率

#### nankan-analyticsクリック数
**GA4 > レポート > ライフサイクル > エンゲージメント > イベント**
- イベント名: cta_click
- パラメータでフィルタ: event_label = "nankan_analytics_cta"
- イベント数を確認

#### オーガニック流入率
**GA4 > レポート > ライフサイクル > 集客 > トラフィック獲得**
- セッションのデフォルト チャネル グループで「Organic Search」のセッション数を確認
- オーガニック流入率 = Organic Search セッション数 ÷ 総セッション数 × 100


## 🎯 Claude Codeが自動的に実行すること

データを提供すると、以下を自動的に実行します：

1. ✅ **前月の総括**
   - 全KPI達成状況を分析
   - 目標 vs 実績を比較
   - 達成率を計算

2. ✅ **成功・失敗した施策の分析**
   - 効果的だった施策の特定
   - 問題点の洗い出し
   - 改善仮説の提示

3. ✅ **当月の計画確認**
   - GA4-GROWTH-ROADMAPに基づく当月のフェーズ確認
   - 当月の目標KPI提示
   - 推奨施策リスト提示

4. ✅ **当月のタスクリスト作成**
   - TodoWriteで優先度付きタスクを作成
   - 週別に整理
   - 実行可能なアクション項目


## ✅ 完了後

1. 上記データを記入
2. Claude Codeで「月次レビュー」を実行
3. 分析結果とタスクリストをコメントに追記
4. このIssueをCloseする

**参考資料:**
- [GA4-GROWTH-ROADMAP.md](https://github.com/apol0510/keiba-review-monorepo/blob/main/GA4-GROWTH-ROADMAP.md)
- [WEEKLY-REVIEW-CHECKLIST.md](https://github.com/apol0510/keiba-review-monorepo/blob/main/WEEKLY-REVIEW-CHECKLIST.md)
- [MAX-POTENTIAL-ANALYSIS.md](https://github.com/apol0510/keiba-review-monorepo/blob/main/MAX-POTENTIAL-ANALYSIS.md)
              `,
              labels: ['monthly-review', 'automated', 'analytics', 'planning']
            });

            console.log('Created issue #' + issue.data.number + ': ' + issue.data.html_url);
